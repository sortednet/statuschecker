# statuschecker
Example Status Checker server written in Golang

# Design

The status checker will allow the registration of services and will periodically poll the given health 
endpoint for each service. Registered services will be persisted to a database. The status will be cached in memory.

A HTTP api will have the registration and status retrieval functions

A prometheus scrape endpoint will also be available to allow for the collection of time series data on the service status.


## Code

The db queries will be generated by sqlc into the store package
??? Mock the Queries type for testing or create a repository interface ???

API written in openapispec with the server stub generated (Echo)

Very small service layer that 
* manages the cache 
* sets promauto values
* get service status

Poller that calls out to each service and updates the cache




# TODO

1. [DONE] Create the db migrations and sqlc files
2. [DONE] build - local build and dev for db
3. [DONE] docker-compose for database
4. [DONE] Makefile - run database migrations
5. [DONE] Makefile - generate with sqlc
6. main with 
   1. viper for properties
   2. db setup
   3. promauto setup
7. test for database queries
8. service impl
   1. BigCache for status cache
   2. setStatus(service string, status ServiceStatus)
   3. getStatus(service) ServiceStatus
   4. getStatusAll() []ServiceStatus
   5. registerService(service, url string) err
   6. unregisterService(service string)
   7. unit tests
9. Openapispec
10. Makefile to generate server stubs
11. Implement controller to call service and translate to HTTP
12. Unit test controller


Write DB code




# Development

## Tools

## Local Environment

### Database

```bash
docker run --platform linux/amd64 -e POSTGRES_USER=statuschecker -e POSTGRES_PASSWORD=password -e POSTGRES_DB=fullstackdb -p 5432:5432 postgres:11.10-alpine
```